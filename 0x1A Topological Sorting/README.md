# 0x1A 위상 정렬

<!--ts-->

- [0x1A 위상 정렬](#0x1a-위상-정렬)
  - [0x00 알고리즘 설명](#0x00-알고리즘-설명)
  - [0x01 구현](#0x01-구현)
  - [0x02 연습 문제](#0x02-연습-문제)

<!-- Created by https://github.com/ekalinin/github-markdown-toc -->
<!-- Added by: sungminyou, at: 2022년 7월 20일 수요일 11시 55분 43초 KST -->

<!--te-->

## 0x00 알고리즘 설명

- 방향 그래프에서 간선으로 주어진 정점 간 선후관계를 위배하지 않도록 나열하는 정렬
- 하나의 그래프에서 여러 개의 위상 정렬 결과가 있을 수 있다
  - 각 스텝마다 indegree가 0이 되는 정점이 여러개 생길 수 있기 때문
- 그래프 내에 사이클이 존재할 경우에는 올바른 위상 정렬이 존재할 수 없다
  - 사이클 내의 어떤 노드로 시작하더라도 선후관계가 위배되므로 모순이다

## 0x01 구현

- indegree가 0인 정점 중 아무거나 고른다
- 선택된 정점을 정렬 결과에 포함시키고, 해당 정점의 outdegree를 모두 지운다
- 사이클이 존재하지 않는 방향 그래프에서 이 알고리즘이 늘 올바른 위상 정렬 결과를 내어준다(각 스텝마다 indegree가 0인 정점이 항상 존재한다는 것을 증명)는 것을 귀류법으로 증명할 수 있다
- 구현의 편의를 위한 성질
  1. 정점과 간선을 실제로 지울 필요 없이 미리 indegree의 값을 저장했다가 매번 뻗어나가는 정점들의 Indegree 값만 1 감소시켜도 과정을 수행 가능
  2. indegree가 0인 정점을 구하기 위해 매번 모든 정점들을 다 확인하는 대신 목록을 따로 저장하고 있다가 직전에 제거한 정점에서 연결된 정점들만 확인하면 된다
  - 실제로 각 스텝에서 정점과 그 정점에서 나가는 간선들을 모두 지우면 O($V^2$)이 될 것이지만 위와 같이 실제로 지우지 않는다면, O(V + E)에 가능하고 더 쉽게 구현할 수 있다
- 성질을 이용하여 알고리즘 스텝 재정의
  1. 맨 처음 모든 간선을 읽으며 Indegree테이블을 채움
  2. indegree가 0인 정점들을 모두 큐에 넣음(굳이 큐 아니더라도 스택이나 배열을 써도 무방)
  3. 큐에서 정점을 꺼내어 위상 정렬 결과에 추가
  4. 해당 정점으로부터 연결된 모든 정점의 Indegree값을 1감소시킴, 이 때 indegree가 0이 되었다면 그 정점을 큐에 추가
  5. 큐가 빌 때까지 3, 4번 과정을 반복
- 만약 이 알고리즘에 사이클이 존재하는 그래프가 input으로 들어오면 어떤 결과가 나올까?

  ![1](https://user-images.githubusercontent.com/48282185/179886118-5bc63710-2871-4afe-9c77-f861123802c8.png)

  - A, B, C 중 어느 것도 indegree가 0이 될 수 없다
    - A의 indegree가 0이 되려면(C가 선택되려면) B의 indegree가 0이 돼야하는데, B의 indegree가 0이 되려면(A가 선택되려면) C의 indegree가 0이 되어(B가 선택되려면) 선택되어야하고, C의 indegree가 0이되려면 A의 indegree가 0이 되어야하기 때문에 데드락 상태이다
  - 그렇기 때문에 사이클에 포함된 정점은 절대 큐에 들어갈 수 없다, 큐가 비어 알고리즘이 종료되었을 때 그 결과가 전체 정점들을 포함하지 않는다
  - 그래서 결과에 전체 정점들이 포함되어있지 않다면, 그래프에 사이클이 있다는 뜻으로 사이클 detection으로 활용할 수 있다

- 시간복잡도
  - 각 정점이 큐에 최대 한 번씩 들어간다
  - indegree를 감소시키는 연산은 각 간선에 대해 딱 한 번씩만 이뤄진다
  - O(V + E)

## 0x02 연습 문제

- 문제에서 원소 간의 선후관계가 주어지고 순서를 정해야하는 상황
- 2252 - 줄 세우기
  - 각 학생이 정점
  - 방향이 있는 정점
    - 키 작은 학생 → 키 큰 학생
  - 선후 관계는 키고 순서를 정해주는 위상 정렬 돌리면 끝
  - 그냥 관계 모델링만 잘하면 됨
- 유명한 응용으로는 위상 정렬 DP가 있으니 연습 문제에 있는 것들 풀어보자

> 바킹독님 유튜브 강의를 참고하여 제작하였습니다.
